$(document).ready(function () {
    //初始化osm地图
    var view = new ol.View({
        projection: ol.proj.get('EPSG:4326'),
        zoom: 10,
        center: [104.068, 30.664],
    })
    var map = new ol.Map({
        target: 'map',
        layer: null,
        view: view
    });
    // osm地图
    var OSM = new ol.layer.Tile({
        source: new ol.source.OSM()
    })

    // 高德地图
    var gaodeMapLayer = new ol.layer.Tile({
        source:new ol.source.XYZ({
            url:'http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}'
        })
    });


    map.addLayer(gaodeMapLayer);

    var style = new ol.style.Style({
        stroke: new ol.style.Stroke({
            color: '#19ff0f',
            width: 2
        }),
        fill:new ol.style.Fill({
            color: 'rgba(255,255,255,0.2)'
        }),
        image: new ol.style.Circle({
            radius: 15,
            fill:new ol.style.Fill({
                color: '#ff382d',
            })
        })
    })

    // 添加矢量
    var pointFeatures = new ol.Feature(new ol.geom.Point([0,0]));
    var lineFeatures = new ol.Feature(new ol.geom.LineString([[101.2939453125,31.640625],[111.4892578125,36.123046875]]));
    var polygonFeatures = new ol.Feature(new ol.geom.Polygon([[[103.93870775171764,33.293454336094186],[103.93921761058859,33.293444457192145],[103.93963765885599,33.293485694579424],[103.9401065825455,33.29361678204976],[103.94060143409803,33.29378379177561],[103.94100649016156,33.29381803764563],[103.94129082508911,33.29379553332595],[103.94166793991575,33.29370589669453],[103.94200813900346,33.293553362151044],[103.94223959400148,33.29338503602159],[103.94247005273576,33.293133761263725],[103.94266360336043,33.292768624787264],[103.94319836561257,33.29148241335843],[103.94340189585787,33.2908893947626],[103.94350865753651,33.290386504052734],[103.94354559527804,33.289771816686816],[103.94347580628734,33.288906490418235],[103.94332720770163,33.28808628669459],[103.94306390271225,33.28693150976163],[103.9428025764702,33.28606454699679],[103.94233874821258,33.284880160409934],[103.94187589531,33.28396359643946],[103.9411486650692,33.28279166834871],[103.93998343903934,33.2811268124502],[103.93946165611118,33.28047314558589],[103.93865051102233,33.27970204242735],[103.93789719886975,33.27912669180867],[103.93650524361931,33.27809765773889],[103.93541356082935,33.2773848690556],[103.9344585379296,33.27679873960106],[103.93329389285951,33.27596604393445],[103.93270805690982,33.27543325370695],[103.93232481423942,33.27497110926682],[103.9318756977855,33.27430918034674],[103.93156131643215,33.273709011867716],[103.93141860388597,33.27325550282463],[103.93133778156943,33.27266299348746],[103.9313497889257,33.27201338874618],[103.93142667023764,33.27147562099878],[103.93155744822643,33.27098574581521],[103.93176308538348,33.27047777409011],[103.93226217902179,33.269612601843846],[103.93292394354856,33.268778158657696],[103.93330122395352,33.26841982309586],[103.93368049013102,33.26813043465687],[103.93427731709778,33.26775575979724],[103.93516653227474,33.26728966806919],[103.9386242214216,33.265506095403886],[103.94119540600244,33.26430430311485],[103.94470097865785,33.26269869547796],[103.94640867584474,33.26182485366027],[103.94789183941796,33.26095836722621],[103.94962923061688,33.25981643533517],[103.95110820996041,33.258780896688044],[103.95420650837313,33.256381485662914],[103.95701630099092,33.254012433057774],[103.9643994061961,33.24726537482395],[103.96808731190606,33.243835846204526],[103.97294182286994,33.23907961730839],[103.97858894729548,33.233293308271264],[103.98528362277361,33.22636314503311],[103.98789396845326,33.223718062247826],[103.98865115157292,33.22301524475629],[103.98943323336542,33.22235631888761],[103.99096948603365,33.22107451629687],[103.99194284256,33.22012519127309],[103.99232441660017,33.21967133280802],[103.99263924298747,33.21922367261815],[103.9929859579518,33.21856305635369],[103.99316230883016,33.218128807971716],[103.99340940964298,33.21729960641895],[103.9935648564336,33.21651565389254],[103.99366949956749,33.21566290193986],[103.99371236586342,33.21505317675276],[103.9937413037573,33.21405475270333],[103.99378123624447,33.21229780074761],[103.99374739634445,33.211642340463115],[103.99367071502155,33.21107595140042],[103.9935741018997,33.21066651846176],[103.9934466040898,33.21029915150148],[103.99328722541792,33.209971854819116],[103.99302324633663,33.20959490941175],[103.99278615824244,33.2093547907081],[103.9926098346034,33.20921042316823],[103.99226415783606,33.20897463119555],[103.99177801476924,33.20870228966011],[103.99104281595021,33.20837973595377],[103.99047098930579,33.208187597395195],[103.99010338387518,33.20809177452642],[103.98954649131392,33.208013511464806],[103.9891051566409,33.2080138448421],[103.98848150325433,33.20809267431583],[103.98798137975781,33.20821210172833],[103.98719930552892,33.208475278744295],[103.98657264271587,33.20873898406037],[103.98539103380901,33.20931213887713],[103.98371224121804,33.210151579702575],[103.98145852028095,33.21109361287213],[103.9799181297348,33.21179066248548],[103.9779990556879,33.21273260983355],[103.97571220913031,33.213974347934744],[103.97456724748808,33.214641156282326],[103.9722991536113,33.21606157960601],[103.97042558457984,33.21733391487113],[103.96930737714867,33.21813543814087],[103.96746155871881,33.219534490563916],[103.96563856306749,33.22100735257078],[103.96348551827259,33.22286972447225],[103.96172708362842,33.22449613429382],[103.9590613124642,33.22715601078839],[103.95797957430032,33.228364845438335],[103.95687485622703,33.229712608377525],[103.95406897289355,33.233414733844945],[103.9526040911217,33.2352998195289],[103.95144130401223,33.23668449799677],[103.95061156216121,33.23768865742732],[103.94898091567367,33.23967985573088],[103.94834957438435,33.2403787290683],[103.94763942342382,33.24108474680322],[103.94670283520807,33.24187315439639],[103.94467792580721,33.2433952065445],[103.94354370105472,33.24415790767626],[103.94249621719663,33.244748509197045],[103.94187468930784,33.24503248267831],[103.94127808800067,33.24525043848014],[103.94070441987222,33.24540238183291],[103.94033427255248,33.245467005333275],[103.93997110409354,33.245503629200364],[103.93944330387731,33.245503561144545],[103.93869398834394,33.24541692129408],[103.93789675450996,33.24524639448682],[103.93709949327928,33.24500388871179],[103.93635209847551,33.24470431286318],[103.93569249594962,33.244361601608155],[103.93519853212315,33.24402460724809],[103.93484227574095,33.24369838041339],[103.93450397953232,33.24331215951916],[103.93425749088792,33.24298375483165],[103.93371161890032,33.24211715512701],[103.93281544216528,33.2406114818068],[103.93194217730439,33.239199681255656],[103.93098904064122,33.23735924186787],[103.93003287996987,33.23514701298109],[103.9290167987606,33.23245214310629],[103.92748359511542,33.22833881917878],[103.92675886313415,33.22664083420843],[103.9258583871421,33.224822115516595],[103.92447562847694,33.22238231862507],[103.92195743432517,33.21830469868186],[103.9196286580206,33.214444488152544],[103.9179158595386,33.211264086943864],[103.91637870929262,33.20823432502031],[103.91486241662854,33.20508952288787],[103.91266268514866,33.2002731550698],[103.91094925313712,33.19693434040372],[103.90996508741244,33.19490618628202],[103.90942153663195,33.193548347812055],[103.90900488687356,33.19213947774503],[103.90881006757327,33.19103530412904],[103.9087381758811,33.1896952382866],[103.90880819931891,33.18814725499463],[103.90892816504571,33.18712889329765],[103.90914807313314,33.18586165696748],[103.90939395241325,33.184774285826144],[103.90965081437514,33.18382581332916],[103.9101804956322,33.182377548589045],[103.91295743225511,33.17801800941154],[103.91427730395233,33.17600054656176],[103.91606360639426,33.17374782495508],[103.91765794896736,33.17168798657389],[103.9195038604685,33.169295037729434],[103.92176604950697,33.166443838473285],[103.92322708317448,33.1647454916303],[103.92459413870644,33.163212043801515],[103.925556714228,33.16205273369054],[103.92625865008637,33.16109256060472],[103.92664505678934,33.160487508568984],[103.92719021517068,33.15944355457845],[103.9275826131176,33.15839978019639],[103.92788216486555,33.15723520027677],[103.92815578415795,33.15545007582014],[103.9284114898456,33.15235287329218],[103.92871008808872,33.14992015745616],[103.92906455336563,33.14817289381671],[103.92979143471122,33.144633359157986],[103.93001111833802,33.14296920777182],[103.93009801639246,33.14178590504065],[103.93013900010912,33.140525718149256],[103.9300234036197,33.13621185359561],[103.92973217390768,33.130691064729646],[103.92928322908587,33.12489867629821],[103.92887310186462,33.12141163496125],[103.92829130173168,33.11697646770922],[103.92820052592496,33.11543465452188],[103.92819363694029,33.11324618288344],[103.92858231399605,33.10575188880612],[103.92898023915386,33.092264753561714],[103.92949174329354,33.083473197780776],[103.92961265588173,33.0806949711169],[103.92981841702628,33.07791563002631],[103.93009102492479,33.075827714242116],[103.9304724220482,33.073963489359436],[103.93081285682729,33.072758855871896],[103.93105943723454,33.07203001811496],[103.93183308414847,33.07010925525475],[103.93336329378317,33.066865262366456],[103.93459696234531,33.06417424860975],[103.93740740495859,33.05729450110269],[103.93864982777353,33.05421153747784],[103.93949404300437,33.05192865698067],[103.94038114547006,33.04921596955599],[103.940774301981,33.04780924002482],[103.94115648346343,33.04625862419704],[103.94141493647865,33.04498203901024],[103.94171232621642,33.043009862468075],[103.94185107035896,33.041426705808135],[103.94190998876587,33.04015547948365],[103.94192102983716,33.03868148230333],[103.94187620545138,33.037160620799725],[103.94172765319097,33.03504836069656],[103.94140354288317,33.032271881789164],[103.94091881105598,33.02928583443572],[103.94026048093542,33.025991300629244],[103.93964999466259,33.02329624876],[103.9393287742864,33.02209164588023],[103.93827128540777,33.018576902570864],[103.93771458833507,33.01666816457201],[103.93728459568244,33.01494607349499],[103.93687755172172,33.01307903625474],[103.93606843335199,33.00924999626777],[103.93550172421175,33.006740632999836],[103.93487013072725,33.004239351047254],[103.9346047253168,33.00297963108211],[103.93422657608308,33.00097159537539],[103.93398409534618,33.000180510567276],[103.93373661077277,32.999627267582284],[103.93344021558543,32.99915104290131],[103.93302105440415,32.99867599686803],[103.93237132849607,32.99813132936146],[103.93156986368281,32.997616840364856],[103.9306286192025,32.99714149146719],[103.92978515045642,32.99679388498998],[103.92865114766016,32.99641564899522],[103.9274791379636,32.99611734993833],[103.92659059635506,32.9959595526606],[103.92534756246481,32.99585209943685],[103.92438502606994,32.99584220014155],[103.923150828225,32.99590250143401],[103.92250473834153,32.99596213641045],[103.92115856121248,32.99614136193036],[103.91967245886313,32.9964055751313],[103.91832307730418,32.996706548908264],[103.91736216811773,32.99697515514074],[103.91649111184316,32.997272631673205],[103.91570192902161,32.99760399141817],[103.91499662809957,32.99796724307529],[103.91452108219511,32.99826136630598],[103.9139576012209,32.99868444792167],[103.91350999752412,32.9991064435616],[103.91267070666734,33.000009334248624],[103.91134475657915,33.00129119537149],[103.91068024537867,33.00197706586071],[103.90999371715228,33.00287278246039],[103.90944406567962,33.00383537143773],[103.908962346421,33.00493382466105],[103.90866650340853,33.00581534126583],[103.90843861650553,33.006597894886056],[103.90807578138374,33.008055033717696],[103.90789185058549,33.00905441524528],[103.90778186823252,33.01016169363099],[103.90773981537617,33.01190950512488],[103.90773765057324,33.0156109539279],[103.90764664203832,33.01702700991595],[103.90754564422808,33.018327148706845],[103.90745860930726,33.020257846164526],[103.90749051749185,33.02188171273202],[103.90758841495514,33.022864998055],[103.90797409652019,33.024722571557184],[103.90851066702825,33.02671098720108],[103.90965368726617,33.03124635892043],[103.91021713978772,33.034343949813675],[103.91104016755546,33.04202421158935],[103.91112302661459,33.04370999786172],[103.91112195771332,33.04526092088531],[103.91097295885385,33.047834209230786],[103.91085498025573,33.049397182705945],[103.91064201148504,33.05234124216114],[103.91028209711321,33.056463550028326],[103.90969113034782,33.06528468506869],[103.90933598213627,33.074123686551204],[103.90916340278801,33.089634956238115],[103.90918322202329,33.09334836197364],[103.90907920875065,33.09521910422775],[103.90890426551651,33.096580230719944],[103.90866137509923,33.09772653326856],[103.90835752794557,33.098711969295344],[103.9077618326067,33.10021515008107],[103.9062225596735,33.10349038370187],[103.90547386059751,33.10524237593628],[103.90499502221674,33.10670148301638],[103.90473908424931,33.10791170253637],[103.90444409835807,33.11048598007959],[103.90436194031192,33.1147830136742],[103.90478745612253,33.121380341323764],[103.9062253359563,33.13062855429442],[103.90817878996327,33.13980454690475],[103.90838360463071,33.14101962875901],[103.90853943607054,33.142521531088924],[103.90856637658969,33.14345087972392],[103.90847137010452,33.14496387551981],[103.90826443818018,33.1463999683076],[103.90767368000878,33.149168285983535],[103.90737080791023,33.1503405878916],[103.90706594990706,33.15111715863532],[103.90671412113396,33.151713864026476],[103.9063522977826,33.1521626685924],[103.90595448844935,33.15255651540862],[103.9056096491958,33.15284741160173],[103.90508888265622,33.153227285591214],[103.9041782612552,33.15378211131874],[103.90348452305903,33.15414199687798],[103.90291971874893,33.15440590787195],[103.90188803509321,33.15483774323705],[103.90104425517684,33.15512661772011],[103.89976452340483,33.15544345070929],[103.89905863689556,33.155573358602496],[103.89699382596042,33.15584204078695],[103.89523981720022,33.15601666268299],[103.89343064423088,33.156207127665496],[103.89245848510092,33.15627180872674],[103.89156229925628,33.15627551789714],[103.89100216465627,33.15623934549203],[103.89048202744252,33.15617019811582],[103.88976481947427,33.1560090217132],[103.8888695282832,33.15572882604356],[103.88825030646728,33.155484706096594],[103.88769309315241,33.15521961603063],[103.8872038959903,33.154934562539275],[103.88677171521938,33.15461855134175],[103.88627750447911,33.154105633432316],[103.8859163491326,33.15359877795242],[103.8854521505143,33.15272410948489],[103.8846638034541,33.15094285676017],[103.88416357012359,33.14977134705322],[103.88375438481853,33.14849895714554],[103.88271406832327,33.141062376089806],[103.88223490618861,33.13763240482965],[103.88102239540794,33.130159675156],[103.88002980805568,33.126719283380986],[103.87888602582771,33.12390529653733],[103.87735687147287,33.1205942655713],[103.87500187327976,33.11610417498768],[103.87128921714682,33.110101478960345],[103.87045133212136,33.10842071149837],[103.8701830593112,33.10752303108896],[103.86987878039425,33.10575491219182],[103.8698047503988,33.10447271851169],[103.86983284266309,33.10316466035396],[103.87013532167532,33.100455890582246],[103.87042171958393,33.099055190168535],[103.87067905750027,33.098173093810665],[103.87119770697795,33.09692553970334],[103.87198964775862,33.095707252859114],[103.8727755398208,33.09488366431023],[103.874149029106,33.09368791183411],[103.87501593090244,33.09291231186068],[103.87615707108934,33.09188911662795],[103.87803581494656,33.090531759897374],[103.88123842374435,33.08852275748403],[103.88371713845596,33.08677672003272],[103.88459268416698,33.086003818637124],[103.88485284079094,33.085745159503034],[103.88509898680115,33.085484490668826],[103.88533012214242,33.08522181194139],[103.88582540605775,33.084607529081545],[103.8865748165907,33.083614639864756],[103.88730118748444,33.08268966906229],[103.88772639376009,33.08213027419747],[103.88824563887528,33.0813370799492],[103.88879789180139,33.080350024844805],[103.88931212395303,33.079211046688215],[103.88969330064086,33.07807999692882],[103.88988439739637,33.077271639185085],[103.89000746980359,33.07650522325867],[103.89009054146639,33.07547097724714],[103.890092576669,33.074700514780076],[103.89004059479673,33.073946019434764],[103.88986859227964,33.07282073324663],[103.8896175609264,33.07173738345158],[103.88934150599744,33.07092283300257],[103.8891084491639,33.07040409241824],[103.88872934198547,33.06976336818336],[103.88822618088336,33.06909459862804],[103.88763196708443,33.06848073499992],[103.88701472285464,33.06793879489288],[103.88649750049734,33.067568774724215],[103.88598226299825,33.067276690719126],[103.88577816449465,33.06718263944436],[103.88557606448931,33.06710157863844],[103.88524089306466,33.066997453125865],[103.8849907605255,33.0669463380514],[103.88481466498187,33.066921247973816],[103.88453450930542,33.0668970911833],[103.88423233652051,33.06688890618224],[103.884026215907,33.066890772755116],[103.88344486374953,33.06692836501886],[103.88282346897417,33.066996895002944],[103.88212800577875,33.06708634249817],[103.8812263736976,33.067183611806826],[103.88068197588363,33.06721117746296],[103.87979329990004,33.06722146879249],[103.87582486753159,33.06721298988176],[103.87388194568986,33.06723406566618],[103.87209904688933,33.067289161842005],[103.87126411603786,33.06728725324127],[103.87064841348698,33.067261585527106],[103.86992256842824,33.06719380879808],[103.86943398983651,33.06711729802012],[103.86855893388373,33.066925402628065],[103.86799924497562,33.066775836127306],[103.86687382671592,33.06644868638634],[103.86637318110785,33.06630815915998],[103.86519562647285,33.066014863926306],[103.86356138497874,33.06573491148029],[103.86281332882938,33.065619983486926],[103.86179986796171,33.065490683388],[103.86087850988368,33.065413449447874],[103.86002422508149,33.065390251734385],[103.85924002384574,33.06542309809552],[103.85850487921454,33.06549897120025],[103.85764852442436,33.06562561510361],[103.85668797739594,33.06582903033115],[103.85564927295385,33.06611624553194],[103.85437714099348,33.066588942209144],[103.85327224945027,33.06713781674741],[103.85245382551365,33.06761917371422],[103.8515943087861,33.0682143710412],[103.85098822514541,33.06871803261552],[103.85039815678557,33.06932664037592],[103.85008959099451,33.06973384775201],[103.84979303879956,33.07026798486947],[103.84962170931385,33.07078833812504],[103.8495375394256,33.07121590045755],[103.84945936681542,33.07193726801162],[103.84935713060472,33.0731072828815],[103.84928898945338,33.07352487846008],[103.84910462021848,33.07436398631803],[103.84884511556405,33.075185979661015],[103.84837018790364,33.0767001274303],[103.8480435406498,33.07788575076227],[103.8478671655652,33.07907062727496],[103.847848088312,33.080006942836015],[103.84790414808256,33.08094338546035],[103.84797825153734,33.08164002556326],[103.84845787635979,33.08707804711943],[103.84899161032763,33.09215640656557],[103.84944927931296,33.09553381937067],[103.84998311235802,33.09818685912218],[103.85035870240328,33.09988529763128],[103.85129419587668,33.10329046222707],[103.85212251487701,33.1060129125135],[103.85709409282642,33.12196659414791],[103.86240949107369,33.137774303383146],[103.86474748788949,33.14424196816466],[103.8672535617139,33.14969239182279],[103.87539002259902,33.1655694580654],[103.87584442746211,33.16624643006897],[103.87644696383303,33.16686157486485],[103.87694540105103,33.167259760580514],[103.87746584926415,33.16761198846553],[103.87804833924368,33.167962262009866],[103.87917524908973,33.16856780556888],[103.88102762517278,33.169544610232876],[103.88191922963739,33.17009589649892],[103.88260766770252,33.17061503321968],[103.88322703800249,33.171203058335124],[103.8840505013563,33.17202504156876],[103.8846698245008,33.17274893973789],[103.88508802318216,33.17344771962461],[103.8852841041541,33.17398347245307],[103.88544015923401,33.17458915272308],[103.88559718940313,33.1757334663825],[103.8856541612125,33.17701063129209],[103.88553103624774,33.17837063552133],[103.88530085965326,33.17960566115874],[103.88487355397059,33.18126128017488],[103.88454933533733,33.182096513531796],[103.88366572796002,33.18408060242776],[103.8834265518552,33.184739997333025],[103.88319936930637,33.185651227898376],[103.88303221022902,33.18683731198824],[103.88292806439178,33.18859805064082],[103.88281887626361,33.191213210055345],[103.88261958851326,33.194721707221724],[103.88261649749803,33.1966943778172],[103.88269649618948,33.19788063622647],[103.88284454262393,33.19897600304968],[103.88301361362365,33.19980156497291],[103.88374093998326,33.2025592027837],[103.88413612354222,33.203693698955924],[103.88448528806319,33.20451137278942],[103.88477242371081,33.20508216918383],[103.88497551945764,33.2054390546344],[103.88541072284417,33.20609987337216],[103.88601199738275,33.20683273129649],[103.88644418871604,33.20725968712966],[103.88695640728989,33.20769367333693],[103.8875256380591,33.208120682669225],[103.88951733085153,33.209443726759474],[103.8918148931048,33.210905619066175],[103.89370216341517,33.21201942437548],[103.89539524822379,33.21314004099695],[103.89718717151827,33.214498387448245],[103.89858099065103,33.21571567680871],[103.89957479200548,33.21676799637194],[103.900753483284,33.218160038363806],[103.90122833073605,33.21889052287609],[103.90146924303976,33.21938917276538],[103.90162817671009,33.2198688405962],[103.90174811242434,33.22052639349061],[103.90180306201712,33.22128588514689],[103.901770044574,33.22188649100622],[103.9016880479407,33.222339199566235],[103.90149107847836,33.22289784822975],[103.90126312279082,33.223289608046834],[103.90088219812641,33.22378130939124],[103.90043428316604,33.224223040296685],[103.89995436792151,33.2245798192196],[103.89952443784982,33.22480667387731],[103.89908750321085,33.22494557839456],[103.89873455063945,33.225016522413185],[103.89814661723302,33.22509244498931],[103.89699969674028,33.22522026409788],[103.89055288823812,33.22623500489654],[103.88949856232058,33.22633451341375],[103.88747979073747,33.22646048801536],[103.8860021000254,33.226604598957096],[103.88519567692394,33.22674303768066],[103.88430416977438,33.226986327889875],[103.88354770532057,33.227309624277574],[103.88291028729556,33.227720922724906],[103.88227684778562,33.2282571262072],[103.88187655581953,33.228703544208265],[103.88162436024933,33.22916005911035],[103.88151026427553,33.22951174338481],[103.8814281840916,33.230003359039735],[103.88141614540548,33.23067091115161],[103.88149916973089,33.23143147303546],[103.88167425332678,33.232298033165385],[103.88196141079446,33.23320264891864],[103.88223256712078,33.233812443847356],[103.88241867595558,33.23415435181676],[103.88275987624127,33.23467424988118],[103.88305905142937,33.23504321386763],[103.88346428680579,33.23544122633878],[103.88382649437588,33.235718283706476],[103.88427774796237,33.23598739789178],[103.88497012255004,33.23631561312856],[103.88548438789483,33.23652478349155],[103.8859866356302,33.236716947733875],[103.88667695831903,33.23694617997274],[103.88726121567258,33.23709838900703],[103.88854372695616,33.23735385109216],[103.89056137177927,33.237724462801765],[103.89249080090724,33.2380938804563],[103.89402400881765,33.23840908684236],[103.89475206415631,33.238603120989815],[103.89532608738638,33.238789110421806],[103.89611608957851,33.23909803823099],[103.89800296140595,33.23992869652158],[103.89879485401579,33.24025452205223],[103.89949473368759,33.24050636867459],[103.90226600501342,33.24153253141585],[103.9028737879866,33.241831254455704],[103.90391836292824,33.242488646397376],[103.90458305853109,33.24299217878036],[103.90537666053984,33.243678539358996],[103.90596733924414,33.24426299741661],[103.90651901796127,33.244906413864186],[103.90705768360593,33.245644759554345],[103.90805002408797,33.24707047823896],[103.90871255902539,33.247920664633725],[103.90904731030622,33.248456177488656],[103.90922516841684,33.24890181225916],[103.90929210841252,33.24920558631025],[103.90947692498659,33.25040872578832],[103.90981759203692,33.25240627987109],[103.90994644021342,33.25369738645191],[103.90996140834991,33.25416008090806],[103.90994739962453,33.254577817992775],[103.90987042687307,33.255209446510825],[103.90965053907276,33.25621689808605],[103.90941666725199,33.25703047898797],[103.90897191591922,33.25829086054891],[103.90884097779531,33.25886754482516],[103.90877799376538,33.25944220183012],[103.90877595767715,33.26026867212956],[103.9088248954988,33.260921233220145],[103.90901869069386,33.26256309963937],[103.90909759015389,33.263597403975524],[103.90908256376532,33.26440589332346],[103.9090085755537,33.265255381916404],[103.9089235997009,33.26598894930077],[103.90883963813589,33.26638373242052],[103.90875867999554,33.26665059568469],[103.90865973286864,33.266928459027184],[103.9084958218623,33.26733226779109],[103.90837089116843,33.267586155636636],[103.90818699519342,33.267882038938616],[103.90808705241261,33.26801099519306],[103.90791715010252,33.26819394292793],[103.90777523159939,33.26832291347957],[103.90761832106897,33.268451888551425],[103.90731149272794,33.26869284379527],[103.90661286721375,33.26918875978178],[103.90483771257423,33.27020960056494],[103.90176678175156,33.271948011927094],[103.89957923988047,33.27320932444569],[103.89851437418939,33.27378893590091],[103.89844537921681,33.27386288596072],[103.89839438117828,33.273952826560645],[103.89834437732988,33.274165689225036],[103.89836836665863,33.27434057963769],[103.89846134619106,33.27455045112627],[103.8985473299942,33.27467537576088],[103.89877328874688,33.274934220176384],[103.89889026572439,33.275082129968446],[103.89899324103911,33.27529699649604],[103.89911320663344,33.27565677120501],[103.89909920128089,33.275822666024865],[103.89904520492483,33.275923601174256],[103.89890821806878,33.276078500078945],[103.89872623605609,33.276239392910426],[103.89869423254402,33.27641128313542],[103.89869922772114,33.27650322519213],[103.89875221247524,33.27668311328956],[103.89885518617449,33.27694994781159],[103.89886917727979,33.277102851600866],[103.89892616447096,33.277205788077616],[103.89900215189347,33.277237769657674],[103.89912613209512,33.277259758133596],[103.89917612415165,33.277262757002774],[103.89929210585419,33.27725576277049],[103.89940008699125,33.27727575087288],[103.89956905351261,33.277367692916094],[103.8996200419766,33.27742065925354],[103.89971002529225,33.27742565544704],[103.89999597693057,33.27727674506857],[103.90037490851631,33.2770298896082],[103.90078982683728,33.27671906628249],[103.90096979340994,33.27647820760123],[103.9012957340941,33.275919537437794],[103.90172963272926,33.275479777190775],[103.90221950338362,33.275049995777216],[103.90308924819715,33.2741634361651],[103.90346213555881,33.27358474070099],[103.90359910108847,33.273178973562516],[103.90373105838147,33.27297707730859],[103.90390499573637,33.27282014364318],[103.90407693155059,33.27268019827133],[103.9044237938821,33.272473256663496],[103.90481962530694,33.27231826525374],[103.9063738866535,33.271625284896395],[103.90732736297124,33.271351147541125],[103.90829577799711,33.271146919074766],[103.90872550662095,33.270961864173756],[103.90919520321032,33.27065985806149],[103.9095799533654,33.27024695092368],[103.90970886550588,33.270160947277994],[103.9098797448611,33.27010890189161],[103.91077508079601,33.269975553911614],[103.91142258182737,33.269700393383786],[103.91152550299219,33.26960040191836],[103.91221095572777,33.26910433854038],[103.91282343270538,33.26894008639728],[103.91396039918473,33.26883644520881],[103.91436101644533,33.26884417717106],[103.91476162177544,33.268924855434754],[103.91622308441725,33.269756278406895],[103.9165387350715,33.26998489397725],[103.91679244667655,33.270250529672154],[103.91692428996099,33.27050926249114],[103.91728984738208,33.27129647342664],[103.91757451024188,33.27163502933211],[103.9186991459571,33.27274838197888],[103.91982371863517,33.2737597431193],[103.92040994813954,33.274278871627175],[103.92246610403548,33.27602973874243],[103.92382011062426,33.27713660280036],[103.9244571326704,33.27780147897615],[103.9253896569707,33.278895725634285],[103.9255284319528,33.279091440758016],[103.92579101093962,33.27929700333987],[103.92593777396289,33.27941375637084],[103.92619535542701,33.27961632212611],[103.92658671540063,33.279868691724076],[103.92743631146867,33.28013147976717],[103.9303562075484,33.2808941635726],[103.93149609914856,33.28112642002845],[103.93234847980267,33.28129008628998],[103.93295730075285,33.28140511594341],[103.9340700978458,33.281608306359814],[103.93428865690537,33.28166993117538],[103.9357077280404,33.28224733525401],[103.93592027645921,33.28242788012859],[103.93602704776032,33.28254063693899],[103.93610088396719,33.28273439573873],[103.93656882072175,33.284375603155226],[103.93681227249995,33.28502879342986],[103.93719442702857,33.285597803855715],[103.93769330480575,33.28651039706551],[103.9377611430664,33.28681309325163],[103.93778706696168,33.28723878317045],[103.93771218501855,33.28822329397338],[103.93764930735352,33.28854020186136],[103.93756248796664,33.288716237842884],[103.93741979115565,33.288850393255316],[103.93715735005885,33.28901272963449],[103.93689590055212,33.28923902165146],[103.93672525688243,33.289412194852495],[103.93661747874236,33.28957527012991],[103.9365096979305,33.28978431627059],[103.93642685943337,33.290088262062305],[103.93636198156226,33.29041616342641],[103.93641481940878,33.291515392294876],[103.93649463820645,33.29178109643907],[103.93666027247299,33.2920866347948],[103.93703940247529,33.29339119781594],[103.93717210469997,33.29366480742404],[103.93740059129675,33.294107151534405],[103.93759614409693,33.29461151051197],[103.93763605063639,33.29475735288901],[103.93775478919099,33.29481911453259],[103.93786255357942,33.29482592826975],[103.93802220511465,33.294800673395095],[103.93821777800777,33.294738379227276],[103.93835946958042,33.29464619434458],[103.93846524189397,33.29450809881362],[103.93852810892798,33.294369077181166],[103.93854108510212,33.294261121915525],[103.93849918569332,33.29409429750485],[103.9384902151298,33.29388644201989],[103.93856206724531,33.2936364738678],[103.93870775171764,33.293454336094186]]]));
    // var polygonFeatures = new ol.Feature(new ol.geom.Polygon([[[-3e6,-1e6],[-3e6,1e6],[-1e6,1e6],[-1e6,-1e6],[-3e6,-1e6]]]));

    var source = new ol.source.Vector({
    })
    source.addFeature(pointFeatures);
    source.addFeature(lineFeatures);
    var vectorLayer = new ol.layer.Vector({
        style: style
    })
    vectorLayer.setSource(source);
    // map.addLayer(vectorLayer);



    var typeSelect = document.getElementById('type');
    var draw = null;
    /**
     * 用户更改绘制类型触发的事件
     * @param ev 更改事件
     */
    typeSelect.onchange = function (ev) {
        map.removeInteraction(draw);
        addInteraction();
    }
    // addInteraction();

    var geoStr = null;
    var currentFeature = null;



    function  addInteraction() {
        var type = typeSelect.value;
        draw = new ol.interaction.Draw({
            type: type,
            source: vectorLayer.getSource()
        });
        map.addInteraction(draw);
        draw.on('drawend', drawAndCallBack,this);
    }


    // 初始化信息设置对话框
    $('#dialog-confirm').dialog({
        modal: true,
        autoOpen: false,
        open:function (event, ui) {
            // 隐藏默认的关闭按钮
            $(".ui-dialog-titlebar-close", $(this).parent()).hide();
            // 根据绘制图形类型进行分别处理
            switch (typeSelect.value) {
                case 'Points':
                    $('#geoType,#infoType').val('Point');
                    break;
                case 'LineString':
                    $('#geoType,#infoType').val('LineString');
                    break;
                case 'Polygon':
                    $('#geoType,#infoType').val('Polygon');
                    break;
                default:
            }
        },
        buttons:{
            '提交':function () {
                submitData();
                $(this).dialog('close');
            },
            '取消':function () {
                $(this).dialog('close');
                // 删除绘制的图形
                vectorLayer.getSource().removeFeature(currentFeature);
            },

        }

    })

    /**
     * 绘制结束后的回调函数
     * @param e
     */
    function drawAndCallBack(e) {
        var geoType = $("#type option:selected").val();
        currentFeature = e.feature;
        $("#dialog-confirm").dialog("open");
        var geometry = currentFeature.getGeometry();
        var coordinates = geometry.getCoordinates();
        if (geoType == 'Polygon') {
            geoStr = coordinates[0].join('],[');
            geoStr = "[[[" + geoStr + "]]]";
        } else if (geoType == "LineString") {
            geoStr = coordinates.join('],[');
            geoStr = "[[" + geoStr + "]]";
        } else {
            geoStr = coordinates.join(',');
            geoStr = "[" + geoStr + "]";
        }
    }






    function submitData() {
        var geoType = $('#type option:selected').val();
        var name = $('#name').val();
        var city = $('#city').val();
        var attrData = name + "," + city;
        if (geoStr != null) {
            saveData(geoType, attrData, geoStr);
            currentFeature = null;
            geoStr = null;
        } else {
            alert('未得到任何绘制图形信息！');
            vectorLayer.getSource().removeFeature(currentFeature);
        }
    };

    /**
     * 提交数据到后台保存
     * @param geoType
     * @param attrData
     * @param geoStr
     */
    function saveData(geoType, attrData, geoStr) {

        var data = {
            type: geoType,
            attr: attrData,
            geometry: geoStr
        };

        $.ajax({
            url: '/Feature/save',
            type: "POST",
            data: JSON.stringify(data),//必要
            dataType:"json",
            contentType:"application/json",
            success:function(response){
                alert(response);
            },
            error:function (err) {
                alert('执行失败')
            }
        });
    }
    // 绑定查询按钮
    $("#query").click(function () {
        $.ajax({
            url: '/Feature/query',
            type: "get",
            success:function (data) {
                var querySource = new ol.source.Vector({
                });
                var queryLayer = new ol.layer.Vector({
                    style: style
                })
                for (var index = 0; index < data.length; index++) {
                    var coordinate = JSON.parse(data[index].geometry);
                    // var coordinate1 = eval("("+coordinate+")");
                    if (data[index].type == "Point") {
                        var point = new ol.Feature(new ol.geom.Point(coordinate));
                        querySource.addFeature(point);
                    }
                    else if (data[index].type == "LineString") {
                        var lineString = new ol.Feature(new ol.geom.LineString(coordinate));
                        querySource.addFeature(lineString);
                    }
                    else if (data[index].type == "Polygon") {
                        var polygon = new ol.Feature(new ol.geom.Polygon(coordinate));
                        querySource.addFeature(polygon);
                    }
                }
                queryLayer.setSource(querySource);
                queryLayer.setStyle(style);
                map.addLayer(queryLayer);
            }

        })
    })

    // 气泡popup
    var popup = new ol.Overlay({
        element: document.getElementById('popup')
    })
    map.addOverlay(popup);

    // 地图点击事件
    map.on('click',function (ev) {
        var element = popup.getElement();
        var popCoordinate = ev.coordinate;
        var hdms = ol.coordinate.toStringHDMS(popCoordinate);
        $(element).popover('destroy');
        popup.setPosition(popCoordinate);
        $(element).popover({
            placement: 'top',
            animation: false,
            html: true,
            content: '<p>您当前位置为：</p><code>' + hdms + '</code>'
        })
        $(element).popover('show');
    });
})


